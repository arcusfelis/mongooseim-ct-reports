<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>/home/travis/build/esl/MongooseIM/apps/ejabberd/logs/ct_run.test@testing-gce-9d1d0b61-c6a1-43e6-95e4-6b0ad3edff69.c.eco-emissary-99515.internal.2016-01-26_09.50.22/mongoose_api_xml.COVER.html</title>
</head><body style='background-color: white; color: black'>
<pre>
File generated from /home/travis/build/esl/MongooseIM/apps/ejabberd/ebin/../src/mongoose_api_xml.erl by COVER 2016-01-26 at 09:50:54

****************************************************************************

        |  %%==============================================================================
        |  %% Copyright 2014 Erlang Solutions Ltd.
        |  %%
        |  %% Licensed under the Apache License, Version 2.0 (the "License");
        |  %% you may not use this file except in compliance with the License.
        |  %% You may obtain a copy of the License at
        |  %%
        |  %% http://www.apache.org/licenses/LICENSE-2.0
        |  %%
        |  %% Unless required by applicable law or agreed to in writing, software
        |  %% distributed under the License is distributed on an "AS IS" BASIS,
        |  %% WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
        |  %% See the License for the specific language governing permissions and
        |  %% limitations under the License.
        |  %%==============================================================================
        |  -module(mongoose_api_xml).
        |  
        |  -behaviour(mongoose_api_format).
        |  
        |  -export([serialize/1, deserialize/1]).
        |  
        |  -include("ejabberd.hrl").
        |  -include_lib("exml/include/exml.hrl").
        |  
        |  %%--------------------------------------------------------------------
        |  %% mongoose_api_format callbacks
        |  %%--------------------------------------------------------------------
        |  serialize(Data) -&gt;
<font color=red>     0..|      do_serialize(Data).</font>
        |  
        |  deserialize(IOList) -&gt;
<font color=red>     0..|      {ok, ParsedXML} = exml:parse(iolist_to_binary([IOList])),</font>
<font color=red>     0..|      ParsedXML.</font>
        |  
        |  %%--------------------------------------------------------------------
        |  %% internal functions
        |  %%--------------------------------------------------------------------
        |  do_serialize(Data) -&gt;
<font color=red>     0..|      exml:to_iolist(prepare_xmlel(Data)).</font>
        |  
        |  prepare_xmlel({ElementName, List}) when is_list(List) -&gt;
<font color=red>     0..|      {Attrs, Children} = lists:partition(fun is_attribute/1, List),</font>
<font color=red>     0..|      #xmlel{name = to_iolist_compliant(ElementName),</font>
<font color=red>     0..|             attrs = [prepare_xmlel(Attr) || Attr &lt;- Attrs],</font>
<font color=red>     0..|             children = [prepare_xmlel(Child) || Child &lt;- Children]};</font>
        |  prepare_xmlel(List) when is_list(List) -&gt;
<font color=red>     0..|      #xmlel{name = &lt;&lt;"list"&gt;&gt;,</font>
<font color=red>     0..|             children = [prepare_xmlel(Element) || Element &lt;- List]};</font>
        |  prepare_xmlel({Key, Value}) -&gt;
<font color=red>     0..|      {to_iolist_compliant(Key), to_iolist_compliant(Value)};</font>
        |  prepare_xmlel(Other) -&gt;
<font color=red>     0..|      #xmlel{name = to_iolist_compliant(Other)}.</font>
        |  
        |  is_attribute({_, List}) when is_list(List) -&gt;
<font color=red>     0..|      false;</font>
        |  is_attribute({_, _}) -&gt;
<font color=red>     0..|      true;</font>
        |  is_attribute(_) -&gt;
<font color=red>     0..|      false.</font>
        |  
        |  to_iolist_compliant(Atom) when is_atom(Atom) -&gt;
<font color=red>     0..|      atom_to_binary(Atom, utf8);</font>
        |  to_iolist_compliant(Int) when is_integer(Int) -&gt;
<font color=red>     0..|      integer_to_binary(Int);</font>
        |  to_iolist_compliant(Other) -&gt;
<font color=red>     0..|      Other.</font>
</pre>
</body>
</html>
